<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Welcome to VEO</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<h1>Welcome to VEO</h1>
<p>Copyright Â© 2020 nisbus</p>
<p><b>Version:</b> 0.2.0</p>
<p><b>Authors:</b> nisbus (<a href="mailto:nisbus@gmail.com"><tt>nisbus@gmail.com</tt></a>).</p>
<h3><a name="VEO_is_a_docker_container_scheduler_with_built_in_DNS.">VEO is a docker container scheduler with built in DNS.</a></h3>
    <br>
   This is a masterless cluster which syncs via Erlang OTP node connections and syncs data using
   Mnesia.
   <br>
   <h4><a name="Getting_started">Getting started</a></h4>
   <br>
   The makefile is the best way to get started with VEO.
   <br>
   <code>make start</code> : Starts a single instance of VEO on your local machine.
   <br>
   <code>make multiple</code> : Starts two instances of VEO in separate docker containers.
   <br>
   <code>make three</code> : Starts three instances of VEO in separate docker containers.
   <br>
   The default cluster.yml (in apps/veo/priv) defines two nodes (uno and dos) which both have the role of master.
   <br>
   It also defines two services (using the nginx container) one in host network mode and other in bridge mode.
   <br>
   If you use start or three with the makefile you should edit the cluster.yml to either remove one host or add the third.
   <br>
   <br>
   <h5><a name="Getting_the_nodes_ready">Getting the nodes ready</a></h5>
   <br>
   This guide assumes you started with make multiple so you now have two containers running VEO (uno and dos).
   <br>
   Start two separate shells and exec into the containers:
   <br>
   <code>docker exec -it uno bash</code>
   <br>   
   <code>docker exec -it dos bash</code>
   <br>
   Now you need to get the nginx image into both containers via docker, so in both run:
   <br>
   <code>docker pull nginx</code>
   <br>
   Change the resolv.conf to point to localhost: <code>echo "nameserver 127.0.0.1" &gt; /etc/resolv.conf</code>
   <br>
   You are now ready to attach to the shell of VEO in each container: <code>./_build/default/rel/veo/bin/veo attach</code>
   <br>
   <h5><a name="Starting_containers">Starting containers</a></h5>
   <br>   
   inside the shell type the following: <code>[H|[T]] = settings:get_applications().</code>
   <br>
   You now have the parsed definitions of the two nginx containers specified in the cluster.yml.
   <br>
   To start a container type <code>container_sup:add_service(T).</code>
   <br>
   You will see one of the nodes starting an nginx container in host mode.
   <h5><a name="Verifying_the_cluster_state_and_DNS">Verifying the cluster state and DNS</a></h5>
   Now that you have a container running we can verify that it is actually there and registered with the DNS in both nodes.
   <br>
   Exit the attached shells in both nodes (CTRL+d) <code>NOTE: CTRL+c will stop the node)</code>
   <br>
   In the shell of both of the nodes type <code>dig ngnix.veo</code>
   <br>
   This should return an A record with the IP of the node that is running the nginx service.
   <br>
   The default configuration file specifies two ports for the nginx service, one is 500 and called port1 and the other one is randomly assigned and bound to nginx port 80 (called website).
   <br>
   You can verify this as well with the DNS:
   <br>
   <code>dig _website._tcp.nginx.veo SRV</code> will show you the port assigned to the nginx container.
   <br>
   <code>curl website.nginx.veo:&lt;PORT FROM SRV QUERY&gt;</code> should show <code>Welcome to ngnix!</code>.
   <br>
   <br>
   Have FUN!
<hr>
<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc</i></p>
</body>
</html>
